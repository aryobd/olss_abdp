@using System.Web.UI.WebControls
@using Dsf.Lib.Constant
@model Dsf.Olss.Models.MTNWorkOrderViewModel

@{
    ViewBag.Title = "Manage Work Order";
    var localeDateFormat = System.Threading.Thread.CurrentThread.CurrentCulture.DateTimeFormat.ShortDatePattern;
}

@section Styles{
    <link href=@Url.Content("~/Content/ui-framework/css/style.css") rel="stylesheet" />
}

<a href="@Url.Action("Schedule", "MTNWorkOrder", new { id = ViewBag.IdMtnMonschdl })" class="btn btn-white"><i class="fa fa-chevron-left"></i> Back</a>
<br><br>

@using (Html.BeginForm("Detail", "MTNWorkOrder", FormMethod.Post))
{
    <section class="panel">
        <div class="panel-body">
            <div class="row">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Work Order Number</label></div>
                        <div class="col-lg-6">
                            @Html.HiddenFor(o => o.IdTbMtnWorkOrder)
                            @Html.HiddenFor(o => o.IdTbMtnMonschdl)
                            @Html.TextBoxFor(o => o.WorkOrderNum, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Estimate Cost</label></div>
                        <div class="col-lg-6">
                            <div class="input-group">
                                <span class="input-group-addon">Rp</span>
                                @Html.TextBoxFor(o => o.EstimateCost, String.Format("{0:N}", Model.EstimateCost), new { @class = "form-control", @readonly = "true" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Brand</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.UnitBrand, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Last Service</label></div>
                        <div class="col-lg-6">
                            <div class="input-group date">
                                @Html.TextBoxFor(o => o.LastService, "{0:MM/dd/yyyy}", new { @class = "form-control", @readonly = "true" })
                                <span class="input-group-addon">
                                    <span class="fa fa-calendar"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Police Number</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.PoliceNumber, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Lates KM</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.LatestKm, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Chassis Number</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.ChassisNumber, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label id="label">Customer Name</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.CustomerName, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Engine Number</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.EngineNumber, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label id="label">Maintenance Type</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.MaintenanceType, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Colour / Year</label></div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.ColourYear, null, new { @class = "form-control", @readonly = "true" })
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label>UP</label>
                        </div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.UpWorkShop, new { @class = "form-control mandatory", @readonly = "true" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>KM Service</label>
                        </div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.KmService, null, new {@class = "form-control", @readonly = "true"})
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label id="label">Phone Number</label>
                        </div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.PhoneNumber, null, new {@class = "form-control", @readonly = "true"})
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                </div>
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6">
                            <label id="label">Fax Number</label>
                        </div>
                        <div class="col-lg-6">
                            @Html.TextBoxFor(o => o.Fax, new { @class = "form-control mandatory numericPhone", @maxlength = 20, @readonly = "true" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="form-group">
                        <div class="col-lg-6"><label>Notes</label></div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="col-lg-12">
                        @Html.TextAreaFor(o => o.Notes, new { @class = "form-control", @rows = "3", @readonly = "true"})
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="panel">
        <header class="panel-heading font-bold">Remarks</header>
        <div class="panel-body">
            <div class="row">
                <div class="col-lg-12">
                    <div class="form-group">
                        <div class="col-lg-12">
                            @if (ViewBag.ApprovalLevelCode == StatusCode.Approve || ViewBag.ApprovalLevelCode == StatusCode.Check)
                            {
                                @Html.TextAreaFor(o => o.Remarks, new { @class = "form-control", @rows = "3", @id = "rmark" })
                                
                            }
                            else
                            {
                                @Html.TextAreaFor(o => o.Remarks, new { @class = "form-control mandatory", @rows = "3", @id = "rmark", @readonly = "true" })
                            }
                            @Html.ValidationMessageFor(o => o.Remarks)
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
}
<section class="panel">
    <header class="panel-heading font-bold">Revision History</header>
    <div class="panel-body">
        <table class="table table-striped table-input m-b-none text-sm">
            <thead>
                <tr>
                    <th>User Name</th>
                    <th>Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.RevHistories != null)
                {
                    for (var i = 0; i < Model.RevHistories.Count; i++)
                    {
                        <tr>
                            <td width="20">
                                @Html.HiddenFor(o => o.RevHistories[i].CreatedBy)
                                <label class="form-control">@Model.RevHistories[i].CreatedBy</label>
                            </td>
                            <td width="20">
                                @Html.HiddenFor(o => o.RevHistories[i].CreatedDate)
                                <label class="form-control">@Model.RevHistories[i].CreatedDate</label>
                            </td>
                            <td width="20">
                                @Html.HiddenFor(o => o.RevHistories[i].Action)
                                <label class="form-control">@Model.RevHistories[i].Action</label>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</section>

@if (ViewBag.IsPassed == true)
{
    <section class="panel">
        <footer class="panel-footer bg-light lter">
            <div class="row">
                <div class="col-lg-6">
                    @if (ViewBag.ApprovalLevelCode == StatusCode.Approve)
                    {
                        <input type="hidden" id="submitButtonText" />
                        @StateButton.MTNWorkOrderStateButton("approve")
                    }
                    else if (ViewBag.ApprovalLevelCode == StatusCode.Check)
                    {
                        if ((ViewBag.JobTitles == JobTitles.MO || ViewBag.JobTitles == JobTitles.MOOPL) && string.Equals(ViewBag.CreatorSkd, Dsf.Olss.Common.SimpleSessionPersister.Username, StringComparison.CurrentCultureIgnoreCase))
                        {
                            <input type="hidden" id="submitButtonText" />
                            @StateButton.OPLAgreementStateButton("check")
                        }
                        else if (ViewBag.JobTitles != JobTitles.MO && ViewBag.JobTitles != JobTitles.MOOPL)
                        {
                            <input type="hidden" id="submitButtonText" />
                            @StateButton.OPLAgreementStateButton("check")
                        }
                    }
                </div>
            </div>
        </footer>
    </section>
}

@{
    Html.RenderPartial("ModalPopUp");
}

@section Scripts{
    <script src="@Url.Content("~/Content/js/OPLAgreement.js")"></script>
    <script src="@Url.Content("~/Content/ui-framework/js/autoNumeric-1.9.18.js")"></script>
    
    <script type="text/javascript">
        
        $(document).ready(function () {
            $('input[name="statusButton"]').attr('type', 'button').attr('data-toggle', 'modal').attr('data-target', '#confirmationModal');
            var tsFields = $('.int-thousand-sp');
            ThousandSeparatorSetUp(tsFields);
        });
        
        // This must be applied to a form (or an object inside a form).
        jQuery.fn.addHidden = function (name, value) {
            return this.each(function () {
                var input = $("<input>").attr("type", "hidden").attr("name", name).val(value);
                $(this).append($(input));
            });
        };
        
        //Confirmation Modal
        $('input[name="statusButton"]').on('click', function (e) {
            var submitvalue = $(this).val();
            var msg = '';
            if (submitvalue === 'Check') {
                msg = 'Check';
            } else if (submitvalue === 'Revise') {
                msg = 'Revise';
            } else if (submitvalue === 'Approve') {
                msg = 'Approve';
            } else if (submitvalue === 'Reject') {
                msg = 'Reject';
            }

            $('#msgModal').text(msg);
            $('#submitButtonText').val(submitvalue);
        });
        
        $('#confirmModal').click(function (e) {

            var submitvalue = $('#submitButtonText').val();
            $('form:first').addHidden('statusButton', submitvalue).trigger('submit');
            $(this).prop('disabled', true);
        });
        
    </script>
}
